# BotFlatMatcher

BotFlatMatcher — телеграм‑бот, который помогает соединить владельцев
квартир и людей, ищущих жильё в Нижнем Новгороде. Проект написан на Go и
использует [Bot API](https://core.telegram.org/bots/api) для работы с
Telegram. В данном файле приведено техническое задание и рекомендации по
организации проекта.

## Зачем нужен бот

* Владельцы жилья публикуют объявления и могут отмечать откликнувшихся
  пользователей.
* Искатели жилья заполняют профиль, просматривают доступные объявления и
  ставят лайки интересным вариантам.
* При взаимном лайке обе стороны получают контакты друг друга.

## Требования к функционалу

### Пользовательские роли
1. **Искатель** — ищет квартиру для аренды.
2. **Владелец** — размещает объявление о сдаче квартиры.

Роль пользователь выбирает при старте (`/start`) и может сменить через
`/role`.

### Профили и объявления
* Для обеих ролей реализуются анкеты: имя, контактные данные, фото.
* Параметры жилья — район, цена, площадь, количество комнат и
  дополнительные условия.
* Искатель может указать параметры поиска (бюджет, районы, площадь и
  т. д.).
* Владелец создаёт одно или несколько объявлений через `/new_listing`.

### Система лайков и матчей
* Искатель листает объявления `/browse_listings` и ставит "лайк" или
  пропускает.
* Владелец листает анкеты искателей `/browse_requests`.
* Когда оба участника поставили лайк друг другу, создаётся запись в
  таблице `matches`, и бот отправляет контактную информацию.

### Дополнительные команды
* `/edit_profile` — редактирование анкеты.
* `/my_profile` — просмотр своей анкеты.
* `/my_matches` — список совпадений.
* `/my_listings` — управление объявлениями для владельца.
* `/likes_received` — кто поставил лайк вашему объявлению или анкете.

## Предлагаемая архитектура

```
cmd/            # точка входа приложения
internal/
  bot/          # инициализация Telegram‑бота и обработчики команд
  db/           # модели, миграции и работа с БД (PostgreSQL)
  domain/       # бизнес‑логика и сущности
  service/      # сервисы (например, работа с файлами)
  scheduler/    # фоновые задачи и уведомления
pkg/            # общие библиотеки, которые могут переиспользоваться
```

Используемые библиотеки на Go:

* [`github.com/go-telegram-bot-api/telegram-bot-api`](https://github.com/go-telegram-bot-api/telegram-bot-api)
  — взаимодействие с Telegram.
* [`github.com/jmoiron/sqlx`](https://github.com/jmoiron/sqlx) или ORM
  для работы с Postgres.
* [`github.com/robfig/cron`](https://github.com/robfig/cron)` (опц.)` —
  планировщик задач для уведомлений.

## Моделирование данных

Ниже приведена упрощённая схема основных таблиц БД.

```
users (user_id PK, role, name, contact, photo_uri, ...)
seeker_profiles (user_id FK, living_with, animals_allowed, ...)
listings (listing_id PK, owner_id FK, district, price, ...)
seeker_likes (seeker_id FK, listing_id FK, timestamp)
owner_likes (owner_id FK, seeker_id FK, timestamp)
matches (match_id PK, seeker_id FK, owner_id FK, listing_id FK, timestamp)
```

Каждая таблица должна иметь индексы по внешним ключам и ограничения
уникальности, как описано в текстовом задании выше.

## Установка и запуск

1. Установите Go версии 1.20 или новее.
2. Склонируйте репозиторий и установите зависимости:

   ```bash
   go mod tidy
   ```

3. Создайте файл `.env` и задайте переменную окружения `BOT_TOKEN` с
   токеном Telegram‑бота и параметры подключения к базе данных (например,
   `DATABASE_URL`).
4. Запустите миграции для создания таблиц.
5. Запустите бота:

   ```bash
   go run ./cmd/bot
   ```

## Дальнейшие шаги разработки

1. Реализовать структуру каталогов по шаблону, приведённому выше.
2. Спроектировать модели БД и написать миграции.
3. Создать обработчики команд Telegram и связать их с бизнес‑логикой.
4. Реализовать хранение файлов (фотографий) и отправку их через бот.
5. Добавить тесты для ключевых компонентов.
6. Настроить CI/CD для автоматического развёртывания.

## Статус

Проект находится на начальной стадии и служит шаблоном. Далее
предполагается наполнять репозиторий исходным кодом бота, тестами и
документацией.
